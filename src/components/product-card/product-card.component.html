<div 
  class="relative group aspect-square bg-gray-200 dark:bg-[#2a2a2a] rounded-lg shadow-lg overflow-hidden transition-all duration-300">
  @if (images().length > 0) {
    @if(!imageError()) {
      <img [src]="currentImage()" [alt]="product().name" (error)="handleImageError()" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy">
    } @else {
      <div class="w-full h-full flex items-center justify-center bg-gray-200 dark:bg-gray-700 text-gray-500 text-xs text-center p-2">
        Image not available
      </div>
    }
  } @else {
     <div class="w-full h-full flex items-center justify-center bg-gray-200 dark:bg-gray-700 text-gray-500 text-xs text-center p-2">
      Image not available
    </div>
  }

  <!-- Overlay -->
  <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent transition-all duration-300 flex flex-col justify-between p-4 text-white opacity-0 group-hover:opacity-100">
    
    <!-- Top Action: View -->
    <div class="text-right rtl:text-left">
      <button (click)="onViewClick($event)" class="p-2 bg-black/40 rounded-full hover:bg-black/60 transition-colors transform translate-y-[-20px] group-hover:translate-y-0 duration-300 cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
      </button>
    </div>

    <!-- Bottom Info -->
    <div class="transform translate-y-8 group-hover:translate-y-0 transition-transform duration-500 ease-out">
      <div class="flex justify-between items-end">
        <div class="text-left rtl:text-right">
          <h3 class="font-bold text-lg">{{ product().name }}</h3>
          <p class="text-xs text-gray-300">{{ product().description }}</p>
        </div>
        
        @if (images().length > 1) {
          <span class="text-xs font-mono font-semibold bg-black/40 text-white px-3 py-1 rounded-full">{{ currentImageIndex() + 1 }} / {{ images().length }}</span>
        } @else {
          <span></span> <!-- Spacer -->
        }
      </div>
    </div>
  </div>

  <!-- Carousel Navigation -->
  @if (images().length > 1) {
    <button (click)="prevImage($event)" class="absolute top-1/2 left-2 rtl:left-auto rtl:right-2 -translate-y-1/2 bg-white/20 p-2 rounded-full opacity-0 group-hover:opacity-100 hover:bg-white/40 transition-all duration-300 disabled:opacity-50 cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white rtl:scale-x-[-1]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    <button (click)="nextImage($event)" class="absolute top-1/2 right-2 rtl:right-auto rtl:left-2 -translate-y-1/2 bg-white/20 p-2 rounded-full opacity-0 group-hover:opacity-100 hover:bg-white/40 transition-all duration-300 disabled:opacity-50 cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white rtl:scale-x-[-1]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  }
</div>